---
- name: Terraform with ansible demo
  become: true
  hosts: Name_tf_ansible
  vars:
    docker_username: "{{ lookup('env', 'DOCKERHUB_USERNAME') }}"
    docker_password: "{{ lookup('env', 'DOCKERHUB_TOKEN') }}"
    docker_image: "{{ lookup('env', 'DOCKERHUB_IMAGE') }}"

  tasks:
    - name: Installing docker
      apt:
        name: docker.io
        state: present
        update_cache: true

    - name: Running application
      docker_container:
        name: "spring_boot_container"
        image: "{{ docker_username }}/{{ docker_image }}:latest"
        pull: always
        state: started
        restart_policy: always
        ports:
          - "80:80"
